!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},n={},r={},o={}.hasOwnProperty,i=/^\.\.?(\/|$)/,a=function(e,t){for(var n,r=[],o=(i.test(t)?e+"/"+t:t).split("/"),a=0,c=o.length;a<c;a++)".."===(n=o[a])?r.pop():"."!==n&&""!==n&&r.push(n);return r.join("/")},c=function(e){return e.split("/").slice(0,-1).join("/")},s=function(t,r){var o,i={id:t,exports:{},hot:v&&v.createHot(t)};return n[t]=i,r(i.exports,(o=t,function(t){var n=a(c(o),t);return e.require(n,o)}),i),i.exports},u=function(e){var t=r[e];return t&&e!==t?u(t):e},l=function(e,r){null==r&&(r="/");var i=u(e);if(o.call(n,i))return n[i].exports;if(o.call(t,i))return s(i,t[i]);throw new Error("Cannot find module '"+e+"' from '"+r+"'")};l.alias=function(e,t){r[t]=e};var f=/\.[^.\/]+$/,h=/\/index(\.[^\/]+)?$/;l.register=l.define=function(e,i){if(e&&"object"==typeof e)for(var a in e)o.call(e,a)&&l.register(a,e[a]);else t[e]=i,delete n[e],function(e){if(f.test(e)){var t=e.replace(f,"");o.call(r,t)&&r[t].replace(f,"")!==t+"/index"||(r[t]=e)}if(h.test(e)){var n=e.replace(h,"");o.call(r,n)||(r[n]=e)}}(e)},l.list=function(){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e};var v=e._hmr&&new e._hmr((function(e,t){return u(a(c(e),t))}),l,t,n);l._cache=n,l.hmr=v&&v.wrap,l.brunch=!0,e.require=l}}(),function(){"undefined"==typeof window||window;require.register("matrix-api/Matrix.js",(function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;var o=t("curvature/base/Uuid"),i=t("curvature/base/Mixin"),a=t("curvature/mixin/EventTargetMixin");function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var o=y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(a,e);var t,n,r,i=p(a);function a(e){var t,n,r,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(this,a),g(m(r=i.call(this)),"ssoUuid",String(new o.Uuid)),g(m(r),"isLoggedIn",!1),g(m(r),"loggingIn",null),r.baseUrl=e||"https://matrix.org/_matrix",r.clientUrl="".concat(r.baseUrl,"/client/v3"),r.mediaUrl="".concat(r.baseUrl,"/media/v3"),r.profileCache=new Map,r.mediaCache=new Map,r.storage=null!==(t=c.storage)&&void 0!==t?t:globalThis.sessionStorage,r.interval=null!==(n=c.interval)&&void 0!==n&&n,r}return t=a,n=[{key:"isLoggedIn",get:function(){this.isLoggedIn&&this.dispatchEvent(new CustomEvent("logged-in"));var e=this.storage.getItem("matrix:access-token")||"false";return JSON.parse(e),this.storage.getItem("matrix:access-token")}},{key:"initSso",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;if(this.storage.getItem("matrix:access-token"))return this.isLoggedIn=!0,void this.dispatchEvent(new CustomEvent("logged-in"));var r=new URLSearchParams({redirectUrl:e}),o="login/sso/redirect?".concat(r),i=400,a=600,c=window.screenX+window.outerWidth/2+i/2,s=window.screenY+window.outerHeight/2-a/2,u="width=".concat(i,",height=").concat(a,",screenX=").concat(c,",screenY=").concat(s),l=(n.open("".concat(this.clientUrl,"/").concat(o),"matrix-login-".concat(this.ssoUuid),u),function e(r){if(r.origin===location.origin&&r.source!==window&&"string"==typeof r.data){var o=JSON.parse(r.data);"s.sso.complete"===o.type&&(t.storage.setItem("matrix:access-token",JSON.stringify(o.data)),t.isLoggedIn=!0,t.dispatchEvent(new CustomEvent("logged-in")),n.removeEventListener("message",e))}});n.addEventListener("message",l)}},{key:"completeSso",value:function(e){var t={type:"m.login.token",token:e,txn_id:(1/Math.random()).toString(36)};fetch("".concat(this.clientUrl,"/").concat("login"),{method:"POST",body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){window.opener.postMessage(JSON.stringify({type:"s.sso.complete",data:e}),location.origin),window.close()}))}},{key:"logIn",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return this.loggingIn||(this.loggingIn=new Promise((function(e){t.loggingIn=null,t.addEventListener("logged-in",(function(t){e(t)}),{once:!0})}))),this.initSso(e,n),this.loggingIn}},{key:"logOut",value:function(){this.storage.removeItem("matrix:access-token"),this.isLoggedIn=!1,this.loggingIn=null,this.dispatchEvent(new CustomEvent("logged-out"))}},{key:"getGuestToken",value:function(){var e=this,t=this.storage.getItem("matrix:access-token")||"false",n=JSON.parse(t);if(n&&n.isGuest)return Promise.resolve(n);var r=new URLSearchParams({kind:"guest"}),o=fetch("".concat(this.clientUrl,"/register?").concat(r),{method:"POST",body:"{}"}).then((function(e){return e.json()}));return o.then((function(t){t.isGuest=!0,e.isLoggedIn=!0,e.storage.setItem("matrix:access-token",JSON.stringify(t))})),o}},{key:"getToken",value:function(){var e=this.storage.getItem("matrix:access-token")||"false",t=JSON.parse(e);return t?Promise.resolve(t):matrix.getGuestToken()}},{key:"listenForServerEvents",value:function(){var e=this,t=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");var n=new URLSearchParams({access_token:t.access_token}),r="".concat(this.clientUrl,"/events?").concat(n);fetch(r).then((function(e){return e.json()})).then((function(t){return e.streamServerEvents(t)}))}},{key:"listenForRoomEvents",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!t||!t.cancelled){var o=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!o)return Promise.reject("No access token found.");var i=new URLSearchParams({access_token:o.access_token,room_id:e,from:r}),a="".concat(this.clientUrl,"/events?").concat(i);return t=t||{cancelled:!1},fetch(a).then((function(e){return e.json()})).then((function(r){return n.streamServerEvents(r,e,t)})),t}}},{key:"streamServerEvents",value:function(e,t,n){var r=this;n&&n.cancelled||(this.interval?setTimeout((function(){t?r.listenForRoomEvents(t,n,e.end):r.listenForServerEvents()}),this.interval):t?this.listenForRoomEvents(t,n,e.end):this.listenForServerEvents(),e.chunk&&e.chunk.forEach((function(e){var t={};e.event_id||(e.event_id="local:".concat(new o.Uuid)),Object.assign(t,e),r.dispatchEvent(new CustomEvent("matrix-event",{detail:t})),r.dispatchEvent(new CustomEvent(t.type,{detail:t}))})))}},{key:"getUserProfile",value:function(e){if(this.profileCache.has(e))return this.profileCache.get(e);var t=fetch("".concat(this.clientUrl,"/profile/").concat(e)).then((function(e){return e.json()}));return this.profileCache.set(e,t),t}},{key:"getUserData",value:function(e){var t=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");var n=new URLSearchParams({access_token:t.access_token});return fetch("".concat(this.clientUrl,"/user/").concat(t.user_id,"/account_data/").concat(e,"?").concat(n)).then((function(e){return e.json()}))}},{key:"putUserData",value:function(e,t){var n=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(n){var r=new URLSearchParams({access_token:n.access_token}),o="".concat(this.clientUrl,"/user/").concat(n.user_id,"/account_data/").concat(e,"?").concat(r);return fetch(o,{method:"PUT",body:t}).then((function(e){if(!e.ok){var t=new Error("HTTP status code: "+e.status);throw t.status=e.status,t.response=e,t}return e})).then((function(e){return e.json()}))}}},{key:"getMediaUrl",value:function(e){var t=new URL(e);return"".concat(this.mediaUrl,"/download/").concat(t.pathname.substr(2))}},{key:"getMedia",value:function(e){if(this.mediaCache.has(e))return this.mediaCache.get(e);var t=fetch(this.getMediaUrl(e)).then((function(e){return Promise.all([e.arrayBuffer(),e.headers.get("Content-type")])})).then((function(e){var t=s(e,2),n=t[0],r=t[1];return URL.createObjectURL(new Blob([n],{type:r}))}));return this.mediaCache.set(e,t),t}},{key:"postMedia",value:function(e,t){var n=this.storage.getItem("matrix:access-token")||"false",r=JSON.parse(n);if(r){var o=new URLSearchParams({access_token:r.access_token}),i="".concat(this.mediaUrl,"/upload?").concat(o),a=new Headers({"Content-Type":e.type});return fetch(i,{method:"POST",headers:a,body:e}).then((function(e){return e.json()}))}}},{key:"putEvent",value:function(e,t,n){var r=this.storage.getItem("matrix:access-token")||"false",o=JSON.parse(r);if(o){var i=new URLSearchParams({access_token:o.access_token}),a="".concat(this.clientUrl,"/rooms/").concat(e,"/send/").concat(t,"/").concat(Math.random().toString(36),"?").concat(i),c=g({method:"PUT",headers:new Headers({"Content-Type":"application/json"}),keepalive:!0,body:JSON.stringify(n)},"keepalive",!0);return fetch(a,c).then((function(e){return e.json()}))}}},{key:"getEvent",value:function(e,t){var n=this.storage.getItem("matrix:access-token")||"false",r=JSON.parse(n);if(r){var o=new URLSearchParams({access_token:r.access_token}),i="".concat(this.clientUrl,"/rooms/").concat(e,"/event/").concat(t,"?").concat(o),a=new Headers({"Content-Type":"application/json"});return fetch(i,{method:"GET",headers:a}).then((function(e){return e.json()}))}}},{key:"sync",value:function(){var e=this.storage.getItem("matrix:access-token")||"false",t=JSON.parse(e);if(!t)return Promise.resolve();var n=new URLSearchParams({full_state:!0,access_token:t.access_token}),r="".concat(this.clientUrl,"/sync?").concat(n);return fetch(r).then((function(e){return e.json()}))}},{key:"getRoomState",value:function(e){var t=this.storage.getItem("matrix:access-token")||"false",n=JSON.parse(t);if(!n)return Promise.resolve();var r=new URLSearchParams({access_token:n.access_token}),o="".concat(this.clientUrl,"/rooms/").concat(e,"/state?").concat(r);return fetch(o).then((function(e){return e.json()}))}},{key:"syncRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.isLoggedIn)return Promise.reject("Logged out.");var r=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!r)return Promise.reject("No access token found.");var o=new URLSearchParams({access_token:r.access_token,room_id:e,dir:"b",from:t||"",filter:n?JSON.stringify(n):""}),i="".concat(this.clientUrl,"/rooms/").concat(e,"/messages?").concat(o),a=new AbortController,c=a.signal,s=function(){return a.abort()};this.addEventListener("logged-out",s,{once:!0});var u=fetch(i,{signal:c}).then((function(e){return e.json()}));return u.finally(this.removeEventListener("logged-out",s)),u}},{key:"syncRoomHistory",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this.syncRoom(e,o,i).then((function(o){if(!t.isLoggedIn)return Promise.reject("Logged out.");var a=new CustomEvent("roomSyncFrame",{detail:{frame:o},cancelable:!0});if(t.dispatchEvent(a)){if(n&&o.chunk){var s,u=c(o.chunk);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(!t.isLoggedIn)return Promise.reject("Logged out.");if(r&&l.origin_server_ts<=r)return Promise.resolve();if(!1===n(l))return Promise.resolve()}}catch(e){u.e(e)}finally{u.f()}}return new Promise((function(a){var c;return setTimeout((function(){return a(o.chunk.length&&t.syncRoomHistory(e,n,r,o.end,i))}),null!==(c=t.interval)&&void 0!==c?c:0)}))}}))}},{key:"getCurrentUserId",value:function(){var e=this.storage.getItem("matrix:access-token")||"false",t=JSON.parse(e);if(t)return t.user_id}},{key:"createRoom",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=JSON.stringify({name:e,topic:t,visibility:n,initial_state:r}),i=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!i)return Promise.resolve();var a=new URLSearchParams({access_token:i.access_token}),c="".concat(this.clientUrl,"/createRoom?").concat(a),s="POST";return fetch(c,{body:o,method:s}).then((function(e){return e.json()}))}},{key:"joinRoom",value:function(e){var t=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");var n=new URLSearchParams({access_token:t.access_token});fetch("".concat(this.clientUrl,"/rooms/").concat(e,"/join?").concat(n),{method:"POST"}).then((function(e){return e.json()}))}},{key:"leaveRoom",value:function(e){var t=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");var n=new URLSearchParams({access_token:t.access_token});fetch("".concat(this.clientUrl,"/rooms/").concat(e,"/leave?").concat(n),{method:"POST"}).then((function(e){return e.json()}))}},{key:"whoAmI",value:function(){var e=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!e)return Promise.reject("No access token found.");var t=new URLSearchParams({access_token:e.access_token});return fetch("".concat(this.clientUrl,"/account/whoami?").concat(t)).then((function(e){return e.json()}))}}],n&&h(t.prototype,n),r&&h(t,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(i.Mixin.with(a.EventTargetMixin));e.Matrix=b})),require.register("matrix-api/MatrixEvent.js",(function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){var t="function"==typeof Map?new Map:void 0;return c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,f(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,e)},c(e)}function s(e,t,n){return s=u()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&l(o,n.prototype),o},s.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.MatrixEvent=void 0;var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(v,e);var t,n,r,c,s,h=(t=v,n=u(),function(){var e,r=f(t);if(n){var o=f(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return a(this,e)});function v(){return i(this,v),h.apply(this,arguments)}return r=v,c&&o(r.prototype,c),s&&o(r,s),Object.defineProperty(r,"prototype",{writable:!1}),r}(c(CustomEvent));e.MatrixEvent=h})),require.register("matrix-api/Room.js",(function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(e,"__esModule",{value:!0}),e.Room=void 0;var i=o((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}));e.Room=i})),require.register("matrix-api/Sync.js",(function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(e,"__esModule",{value:!0}),e.Sync=void 0;var i=o((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}));e.Sync=i})),require.register("matrix-api/User.js",(function(e,t,n){})),require.register("___globals___",(function(e,t,n){}))}(),require("___globals___");
