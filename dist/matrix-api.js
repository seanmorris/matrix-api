!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},n={},r={},o={}.hasOwnProperty,c=/^\.\.?(\/|$)/,a=function(e,t){for(var n,r=[],o=(c.test(t)?e+"/"+t:t).split("/"),a=0,s=o.length;a<s;a++)".."===(n=o[a])?r.pop():"."!==n&&""!==n&&r.push(n);return r.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},i=function(t,r){var o,c={id:t,exports:{},hot:m&&m.createHot(t)};return n[t]=c,r(c.exports,(o=t,function(t){var n=a(s(o),t);return e.require(n,o)}),c),c.exports},u=function(e){var t=r[e];return t&&e!==t?u(t):e},l=function(e,r){null==r&&(r="/");var c=u(e);if(o.call(n,c))return n[c].exports;if(o.call(t,c))return i(c,t[c]);throw new Error("Cannot find module '"+e+"' from '"+r+"'")};l.alias=function(e,t){r[t]=e};var f=/\.[^.\/]+$/,h=/\/index(\.[^\/]+)?$/;l.register=l.define=function(e,c){if(e&&"object"==typeof e)for(var a in e)o.call(e,a)&&l.register(a,e[a]);else t[e]=c,delete n[e],function(e){if(f.test(e)){var t=e.replace(f,"");o.call(r,t)&&r[t].replace(f,"")!==t+"/index"||(r[t]=e)}if(h.test(e)){var n=e.replace(h,"");o.call(r,n)||(r[n]=e)}}(e)},l.list=function(){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e};var m=e._hmr&&new e._hmr(function(e,t){return u(a(s(e),t))},l,t,n);l._cache=n,l.hmr=m&&m.wrap,l.brunch=!0,e.require=l}}(),"undefined"==typeof window||window,require.register("matrix-api/Matrix.js",function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;var o=t("curvature/base/Mixin"),c=t("curvature/mixin/EventTargetMixin");function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(o,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return u(this,n)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this),(t=r.call(this)).baseUrl=e||"https://matrix.org/_matrix",t.clientUrl="".concat(t.baseUrl,"/client/r0"),t.mediaUrl="".concat(t.baseUrl,"/media/r0"),t.profileCache=new Map,t.mediaCache=new Map,t}return t=o,(n=[{key:"isLoggedIn",get:function(){sessionStorage.getItem("matrix:access-token")&&this.dispatchEvent(new CustomEvent("logged-in"));var e=sessionStorage.getItem("matrix:access-token")||"false";return JSON.parse(e),sessionStorage.getItem("matrix:access-token")}},{key:"initSso",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r="login/sso/redirect?redirectUrl="+e,o=window.screenX+window.outerWidth/2+200,c=window.screenY+window.outerHeight/2-300,a="width=".concat(400,",height=").concat(600,",screenX=").concat(o,",screenY=").concat(c),s=(n.open("".concat(this.clientUrl,"/").concat(r),"matrix-login",a),function(e){if(e.origin===location.origin&&e.source!==window&&"string"==typeof e.data){var n=JSON.parse(e.data);"s.sso.complete"===n.type&&(sessionStorage.setItem("matrix:access-token",JSON.stringify(n.data)),t.dispatchEvent(new CustomEvent("logged-in")))}});n.addEventListener("message",s)}},{key:"completeSso",value:function(e){var t={type:"m.login.token",token:e,txn_id:(1/Math.random()).toString(36)};fetch("".concat(this.clientUrl,"/").concat("login"),{method:"POST",body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){window.opener.postMessage(JSON.stringify({type:"s.sso.complete",data:e}),location.origin),window.close()})}},{key:"getGuestToken",value:function(){var e=sessionStorage.getItem("matrix:access-token")||"false",t=JSON.parse(e);if(t&&t.isGuest)return Promise.resolve(t);var n=fetch("".concat(this.clientUrl,"/register?kind=guest"),{method:"POST",body:"{}"}).then(function(e){return e.json()});return n.then(function(e){e.isGuest=!0,sessionStorage.setItem("matrix:access-token",JSON.stringify(e))}),n}},{key:"getToken",value:function(){var e=sessionStorage.getItem("matrix:access-token")||"false",t=JSON.parse(e);return t?Promise.resolve(t):matrix.getGuestToken()}},{key:"listenForServerEvents",value:function(){var e=this,t=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");var n="".concat(this.clientUrl,"/events?access_token=").concat(t.access_token);fetch(n).then(function(e){return e.json()}).then(function(t){return e.streamServerEvents(t)})}},{key:"listenForRoomEvents",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!t||!t.cancelled){var o=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(!o)return Promise.reject("No access token found.");var c="".concat(this.clientUrl,"/events?room_id=").concat(e,"&access_token=").concat(o.access_token,"&from=").concat(r);return t=t||{cancelled:!1},fetch(c).then(function(e){return e.json()}).then(function(r){return n.streamServerEvents(r,e,t)}),t}}},{key:"getUserProfile",value:function(e){if(this.profileCache.has(e))return this.profileCache.get(e);var t=fetch("".concat(this.clientUrl,"/profile/").concat(e)).then(function(e){return e.json()});return this.profileCache.set(e,t),t}},{key:"getUserData",value:function(e){var t=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");return t?fetch("".concat(this.clientUrl,"/user/").concat(t.user_id,"/account_data/").concat(e,"?access_token=").concat(t.access_token)).then(function(e){return e.json()}):Promise.reject("No access token found.")}},{key:"putUserData",value:function(e,t){var n=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(n){var r="".concat(this.clientUrl,"/user/").concat(n.user_id,"/account_data/").concat(e,"?access_token=").concat(n.access_token);return fetch(r,{method:"PUT",body:t}).then(function(e){if(!e.ok){var t=new Error("HTTP status code: "+e.status);throw t.status=e.status,t.response=e,t}return e}).then(function(e){return e.json()})}}},{key:"getMediaUrl",value:function(e){var t=new URL(e);return"".concat(this.mediaUrl,"/download/").concat(t.pathname.substr(2))}},{key:"getMedia",value:function(e){if(this.mediaCache.has(e))return this.mediaCache.get(e);var t=fetch(this.getMediaUrl(e)).then(function(e){return Promise.all([e.arrayBuffer(),e.headers.get("Content-type")])}).then(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];return URL.createObjectURL(new Blob([n],{type:r}))});return this.mediaCache.set(e,t),t}},{key:"postMedia",value:function(e,t){var n=sessionStorage.getItem("matrix:access-token")||"false",r=JSON.parse(n);if(r){var o="".concat(this.mediaUrl,"/upload?access_token=").concat(r.access_token),c=new Headers({"Content-Type":e.type});return fetch(o,{method:"POST",headers:c,body:e}).then(function(e){return e.json()})}}},{key:"putEvent",value:function(e,t,n){var r=sessionStorage.getItem("matrix:access-token")||"false",o=JSON.parse(r);if(o){var c="".concat(this.clientUrl,"/rooms/").concat(e,"/send/").concat(t,"/").concat(Math.random().toString(36),"?access_token=").concat(o.access_token),a={method:"PUT",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(n)};return fetch(c,a).then(function(e){return e.json()})}}},{key:"getEvent",value:function(e,t){var n=sessionStorage.getItem("matrix:access-token")||"false",r=JSON.parse(n);if(r){var o="".concat(this.clientUrl,"/rooms/").concat(e,"/event/").concat(t,"?access_token=").concat(r.access_token),c=new Headers({"Content-Type":"application/json"});return fetch(o,{method:"GET",headers:c}).then(function(e){return e.json()})}}},{key:"sync",value:function(){var e=sessionStorage.getItem("matrix:access-token")||"false",t=JSON.parse(e);if(!t)return Promise.resolve();var n="".concat(this.clientUrl,"/sync?full_state=true&access_token=").concat(t.access_token);return fetch(n).then(function(e){return e.json()})}},{key:"getRoomState",value:function(e){var t=sessionStorage.getItem("matrix:access-token")||"false",n=JSON.parse(t);if(!n)return Promise.resolve();var r="".concat(this.clientUrl,"/rooms/").concat(e,"/state?access_token=").concat(n.access_token);return fetch(r).then(function(e){return e.json()})}},{key:"syncRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(!n)return Promise.reject("No access token found.");var r="".concat(this.clientUrl,"/rooms/").concat(e,"/messages?dir=b&room_id=").concat(e,"&access_token=").concat(n.access_token,"&from=").concat(t);return fetch(r).then(function(e){return e.json()})}},{key:"syncRoomHistory",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.syncRoom(e,t).then(function(t){var o=new CustomEvent("roomSyncFrame",{detail:{frame:t},cancelable:!0});if(n.dispatchEvent(o))return t.chunk&&r&&t.chunk.forEach(r),new Promise(function(o){setTimeout(function(){return o(t.chunk.length&&n.syncRoomHistory(e,t.end,r))},100)})})}},{key:"streamServerEvents",value:function(e,t,n){var r=this;n&&n.cancelled||(t?this.listenForRoomEvents(t,n,e.end):this.listenForServerEvents(),e.chunk&&e.chunk.forEach(function(e){var t={};e.event_id||(e.event_id="local:"+(1/Math.random()).toString(36)),Object.assign(t,e),r.dispatchEvent(new CustomEvent("matrix-event",{detail:t})),r.dispatchEvent(new CustomEvent(t.type,{detail:t}))}))}},{key:"getCurrentUserId",value:function(){var e=sessionStorage.getItem("matrix:access-token")||"false",t=JSON.parse(e);if(t)return t.user_id}},{key:"createRoom",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=JSON.stringify({name:e,topic:t,visibility:n,initial_state:r}),c=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(!c)return Promise.resolve();var a="".concat(this.clientUrl,"/createRoom?access_token=").concat(c.access_token);return fetch(a,{body:o,method:"POST"}).then(function(e){return e.json()})}},{key:"joinRoom",value:function(e){var t=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");fetch("".concat(this.clientUrl,"/rooms/").concat(e,"/join?access_token=").concat(t.access_token),{method:"POST"}).then(function(e){return e.json()})}},{key:"leaveRoom",value:function(e){var t=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");fetch("".concat(this.clientUrl,"/rooms/").concat(e,"/leave?access_token=").concat(t.access_token),{method:"POST"}).then(function(e){return e.json()})}},{key:"whoAmI",value:function(){var e=JSON.parse(sessionStorage.getItem("matrix:access-token")||"false");return e?fetch("".concat(this.clientUrl,"/account/whoami?access_token=").concat(e.access_token)).then(function(e){return e.json()}):Promise.reject("No access token found.")}}])&&s(t.prototype,n),o}(o.Mixin.with(c.EventTargetMixin));e.Matrix=f}),require.register("___globals___",function(e,t,n){}),require("___globals___");
